<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title></title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.26.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.26.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>


<style>
    #menu {
        background: #fff;
        position: absolute;
        z-index: 1;
        top: 10px;
        right: 10px;
        border-radius: 3px;
        width: 120px;
        border: 1px solid rgba(0,0,0,0.4);
        font-family: 'Open Sans', sans-serif;
    }
    #menu a {
        font-size: 13px;
        color: #404040;
        display: block;
        margin: 0;
        padding: 0;
        padding: 10px;
        text-decoration: none;
        border-bottom: 1px solid rgba(0,0,0,0.25);
        text-align: center;
    }
    #menu a:last-child {
        border: none;
    }
    #menu a:hover {
        background-color: #f8f8f8;
        color: #404040;
    }
    #menu a.active {
        background-color: #3887be;
        color: #ffffff;
    }
    #menu a.active:hover {
        background: #3074a4;
    }

    .mapboxgl-popup {
        max-width: 250px;
        font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
    }

.legend {
    background-color: #fff;
    border-radius: 3px;
    bottom: 30px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.10);
    font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
    padding: 10px;
    position: absolute;
    right: 10px;
    z-index: 1;
}

.legend h4 {
    margin: 0 0 10px;
}

.legend div span {
    border-radius: 50%;
    display: inline-block;
    height: 10px;
    margin-right: 5px;
    width: 10px;
} 

</style>
<div id='map'></div>
<div id='state-legend' class='legend'>
    <h4>Yield (bu/ac)</h4>
    <div><span style='background-color: #00ff00'></span>200</div>
    <div><span style='background-color: #ffff00'></span>175</div>
    <div><span style='background-color: #ff0000'></span>150</div>
    <div><span style='background-color: #000000'></span>0</div>
</div>


<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v0.12.1/mapbox-gl-draw.js'></script>
<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v0.12.1/mapbox-gl-draw.css' type='text/css'/>

<nav id="menu"></nav>

<script>
mapboxgl.accessToken = 'pk.eyJ1IjoiZG1ja2lubm8iLCJhIjoiY2lnMnVuaGU4MWZmbHVqbHZvM3BmbWt0ciJ9.zR7Bu1hN-5-yEjV5x9DEjg';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/dmckinno/cj9eq9vqx47r22sq7m2ke1mhx',
    zoom: 3.5,
    center: [-97, 41]
});

var zoomThreshold = 5;
var nat_zoomThreshold = 3;


//These map.on functions load individual layers. The options should be self-explanatory.

map.on('load', function () {
    map.addSource('2011-5o3ofc', {
        type: 'vector',
        url: 'mapbox://dmckinno.anmxsp9o'
    });
    map.addLayer({
        "id": "2011",
        "type": "fill",
        "source": "2011-5o3ofc",
        "source-layer": "2011-5o3ofc",
        'minzoom': zoomThreshold,
        'layout': {
            'visibility': 'none'
        }, 
        "paint": {
             'fill-color': {
                property: 'prediction',
                type: 'exponential',
                'stops': [[0,'#000000'],[150,'#ff0000'],[175,'#ffff00'],[200,'#00ff00']]
                },
        }
    });
});

map.on('load', function () {
    map.addSource('2012-bbv541', {
        type: 'vector',
        url: 'mapbox://dmckinno.9p34v9r2'
    });
    map.addLayer({
        "id": "2012",
        "type": "fill",
        "source": "2012-bbv541",
        "source-layer": "2012-bbv541",
        'minzoom': zoomThreshold,
        'layout': {
            'visibility': 'none'
        }, 
        "paint": {
             'fill-color': {
                property: 'prediction',
                type: 'exponential',
                'stops': [[0,'#000000'],[150,'#ff0000'],[175,'#ffff00'],[200,'#00ff00']]
                },
        }
    });
});

map.on('load', function () {
    map.addSource('2013-5u7olp', {
        type: 'vector',
        url: 'mapbox://dmckinno.0gyh5msy'
    });
    map.addLayer({
        "id": "2013",
        "type": "fill",
        "source": "2013-5u7olp",
        "source-layer": "2013-5u7olp",
        'minzoom': zoomThreshold,
        'layout': {
            'visibility': 'none'
        }, 
        "paint": {
             'fill-color': {
                property: 'prediction',
                type: 'exponential',
                'stops': [[0,'#000000'],[150,'#ff0000'],[175,'#ffff00'],[200,'#00ff00']]
                },
        }
    });
});

map.on('load', function () {
    map.addSource('2014-144iff', {
        type: 'vector',
        url: 'mapbox://dmckinno.0nkmgsjm'
    });
    map.addLayer({
        "id": "2014",
        "type": "fill",
        "source": "2014-144iff",
        "source-layer": "2014-144iff",
        'minzoom': zoomThreshold,
        'layout': {
            'visibility': 'none'
        }, 
        "paint": {
             'fill-color': {
                property: 'prediction',
                type: 'exponential',
                'stops': [[0,'#000000'],[150,'#ff0000'],[175,'#ffff00'],[200,'#00ff00']]
                },
        }
    });
});

map.on('load', function () {
    map.addSource('2011_by_state-55g7fy', {
        type: 'vector',
        url: 'mapbox://dmckinno.c71ofp9v'
    });
    map.addLayer({
        "id": "2011_state",
        "type": "fill",
        "source": "2011_by_state-55g7fy",
        "source-layer": "2011_by_state-55g7fy",
        'maxzoom': zoomThreshold,
        'layout': {
            'visibility': 'none'
        }, 
        "paint": {
             'fill-color': {
                property: 'meanpredic',
                type: 'exponential',
                'stops': [[0,'#000000'],[150,'#ff0000'],[175,'#ffff00'],[200,'#00ff00']]
                },
        }
    });
});

map.on('load', function () {
    map.addSource('2012_by_state-6zyhjq', {
        type: 'vector',
        url: 'mapbox://dmckinno.2utaztly'
    });
    map.addLayer({
        "id": "2012_state",
        "type": "fill",
        "source": "2012_by_state-6zyhjq",
        "source-layer": "2012_by_state-6zyhjq",
        'maxzoom': zoomThreshold,
        'layout': {
            'visibility': 'none'
        }, 
        "paint": {
             'fill-color': {
                property: 'meanpredic',
                type: 'exponential',
                'stops': [[0,'#000000'],[150,'#ff0000'],[175,'#ffff00'],[200,'#00ff00']]
                },
        }
    });
});

map.on('load', function () {
    map.addSource('2013_by_state-aneymf', {
        type: 'vector',
        url: 'mapbox://dmckinno.7ygawp0k'
    });
    map.addLayer({
        "id": "2013_state",
        "type": "fill",
        "source": "2013_by_state-aneymf",
        "source-layer": "2013_by_state-aneymf",
        'maxzoom': zoomThreshold,
        'layout': {
            'visibility': 'none'
        }, 
        "paint": {
             'fill-color': {
                property: 'meanpredic',
                type: 'exponential',
                'stops': [[0,'#000000'],[150,'#ff0000'],[175,'#ffff00'],[200,'#00ff00']]
                },
        }
    });
});

map.on('load', function () {
    map.addSource('2014_by_state-2whnn6', {
        type: 'vector',
        url: 'mapbox://dmckinno.amp632pp'
    });
    map.addLayer({
        "id": "2014_state",
        "type": "fill",
        "source": "2014_by_state-2whnn6",
        "source-layer": "2014_by_state-2whnn6",
        'maxzoom': zoomThreshold,
        'layout': {
            'visibility': 'none'
        }, 
        "paint": {
             'fill-color': {
                property: 'meanpredic',
                type: 'exponential',
                'stops': [[0,'#000000'],[150,'#ff0000'],[175,'#ffff00'],[200,'#00ff00']]
                },
        }
    });
});

map.on('load', function () {
    map.addSource('2011_national-d8hh5o', {
        type: 'vector',
        url: 'mapbox://dmckinno.0w761pn4'
    });
    map.addLayer({
        "id": "2011_national",
        "type": "fill",
        "source": "2011_national-d8hh5o",
        "source-layer": "2011_national-d8hh5o",
        'maxzoom': nat_zoomThreshold,
        'layout': {
            'visibility': 'none'
        }, 
        "paint": {
             'fill-color': {
                property: 'meanpredic',
                type: 'exponential',
                'stops': [[0,'#000000'],[150,'#ff0000'],[175,'#ffff00'],[200,'#00ff00']]
                },
        }
    });
});

map.on('load', function () {
    map.addSource('2012_national-a1tmu7', {
        type: 'vector',
        url: 'mapbox://dmckinno.a6fco96p'
    });
    map.addLayer({
        "id": "2012_national",
        "type": "fill",
        "source": "2012_national-a1tmu7",
        "source-layer": "2012_national-a1tmu7",
        'maxzoom': nat_zoomThreshold,
        'layout': {
            'visibility': 'none'
        }, 
        "paint": {
             'fill-color': {
                property: 'meanpredic',
                type: 'exponential',
                'stops': [[0,'#000000'],[150,'#ff0000'],[175,'#ffff00'],[200,'#00ff00']]
                },
        }
    });
});

map.on('load', function () {
    map.addSource('2013_national-5t1xyl', {
        type: 'vector',
        url: 'mapbox://dmckinno.47cj7lbw'
    });
    map.addLayer({
        "id": "2013_national",
        "type": "fill",
        "source": "2013_national-5t1xyl",
        "source-layer": "2013_national-5t1xyl",
        'maxzoom': nat_zoomThreshold,
        'layout': {
            'visibility': 'none'
        }, 
        "paint": {
             'fill-color': {
                property: 'meanpredic',
                type: 'exponential',
                'stops': [[0,'#000000'],[150,'#ff0000'],[175,'#ffff00'],[200,'#00ff00']]
                },
        }
    });
});

map.on('load', function () {
    map.addSource('2014_national-2rjbby', {
        type: 'vector',
        url: 'mapbox://dmckinno.dizcef1q'
    });
    map.addLayer({
        "id": "2014_national",
        "type": "fill",
        "source": "2014_national-2rjbby",
        "source-layer": "2014_national-2rjbby",
        'maxzoom': nat_zoomThreshold,
        'layout': {
            'visibility': 'none'
        }, 
        "paint": {
             'fill-color': {
                property: 'meanpredic',
                type: 'exponential',
                'stops': [[0,'#000000'],[150,'#ff0000'],[175,'#ffff00'],[200,'#00ff00']]
                },
        }
    });
});

//This block creates the buttons that enable the user to turn layers on and off
var toggleableLayerIds2011 = ['2011', '2011_state','2011_national'];

var link = document.createElement('a');
link.href = '#';
link.className = 'active';
link.textContent = "2011";
link.onclick = function (e) {
    for(var index in toggleableLayerIds2011) {
      var clickedLayer = toggleableLayerIds2011[index];
      e.preventDefault();
      e.stopPropagation();
  
      var visibility = map.getLayoutProperty(clickedLayer, 'visibility');
  
      if (visibility === 'visible') {
          map.setLayoutProperty(clickedLayer, 'visibility', 'none');
          this.className = '';
      } else {
          this.className = 'active';
          map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
      }
    }
    
};
var layers = document.getElementById('menu');
layers.appendChild(link);

var toggleableLayerIds2012 = ['2012', '2012_state','2012_national'];

var link = document.createElement('a');
link.href = '#';
link.className = 'active';
link.textContent = "2012";
link.onclick = function (e) {
    for(var index in toggleableLayerIds2012) {
      var clickedLayer = toggleableLayerIds2012[index];
      e.preventDefault();
      e.stopPropagation();
  
      var visibility = map.getLayoutProperty(clickedLayer, 'visibility');
  
      if (visibility === 'visible') {
          map.setLayoutProperty(clickedLayer, 'visibility', 'none');
          this.className = '';
      } else {
          this.className = 'active';
          map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
      }
    }
    
};
var layers = document.getElementById('menu');
layers.appendChild(link);

var toggleableLayerIds2013 = ['2013', '2013_state','2013_national'];

var link = document.createElement('a');
link.href = '#';
link.className = 'active';
link.textContent = "2013";
link.onclick = function (e) {
    for(var index in toggleableLayerIds2013) {
      var clickedLayer = toggleableLayerIds2013[index];
      e.preventDefault();
      e.stopPropagation();
  
      var visibility = map.getLayoutProperty(clickedLayer, 'visibility');
  
      if (visibility === 'visible') {
          map.setLayoutProperty(clickedLayer, 'visibility', 'none');
          this.className = '';
      } else {
          this.className = 'active';
          map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
      }
    }
    
};
var layers = document.getElementById('menu');
layers.appendChild(link);

var toggleableLayerIds2014 = ['2014', '2014_state','2014_national'];

var link = document.createElement('a');
link.href = '#';
link.className = 'active';
link.textContent = "2014";
link.onclick = function (e) {
    for(var index in toggleableLayerIds2014) {
      var clickedLayer = toggleableLayerIds2014[index];
      e.preventDefault();
      e.stopPropagation();
  
      var visibility = map.getLayoutProperty(clickedLayer, 'visibility');
  
      if (visibility === 'visible') {
          map.setLayoutProperty(clickedLayer, 'visibility', 'none');
          this.className = '';
      } else {
          this.className = 'active';
          map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
      }
    }
    
};
var layers = document.getElementById('menu');
layers.appendChild(link);

//var toggleableLayerIds = ['2012', '2012_state'];
//
//var link = document.createElement('a');
//link.href = '#';
//link.className = 'active';
//link.textContent = "2012";
//link.onclick = function (e) {
//    for(var index in toggleableLayerIds2012) {
//      var clickedLayer2012 = toggleableLayerIds2012[index];
//      e.preventDefault();
//      e.stopPropagation();
//  
//      var visibility2012 = map.getLayoutProperty(clickedLayer2012, 'visibility');
//  
//      if (visibility2012 === 'visible') {
//          map.setLayoutProperty(clickedLayer2012, 'visibility', 'none');
//          this.className = '';
//      } else {
//          this.className = 'active';
//          map.setLayoutProperty(clickedLayer2012, 'visibility', 'visible');
//      }
//    }
//    
//};
//var layers = document.getElementById('menu');
//layers.appendChild(link);



//var toggleableLayerIds = ['2012','2012_state','2012_national'];
//
//var link = document.createElement('a');
//link.href = '#';
//link.className = 'active';
//link.textContent = "2012";
//link.onclick = function (e) {
//    for(var index in toggleableLayerIds2012) {
//      var clickedLayer2012 = toggleableLayerIds2012[index];
//      e.preventDefault();
//      e.stopPropagation();
//  
//      var visibility2012 = map.getLayoutProperty(clickedLayer2012, 'visibility');
//  
//      if (visibility2012 === 'visible') {
//          map.setLayoutProperty(clickedLayer2012, 'visibility', 'none');
//          this.className = '';
//      } else {
//          this.className = 'active';
//          map.setLayoutProperty(clickedLayer2012, 'visibility', 'visible');
//      }
//    }
//    
//};
//var layers = document.getElementById('menu');
//layers.appendChild(link);



//var toggleableLayerIds = ['2013','2013_state'];
//
//var link = document.createElement('a');
//link.href = '#';
//link.className = 'active';
//link.textContent = "2013";
//link.onclick = function (e) {
//    for(var index in toggleableLayerIds) {
//      var clickedLayer = toggleableLayerIds[index];
//      e.preventDefault();
//      e.stopPropagation();
//  
//      var visibility = map.getLayoutProperty(clickedLayer, 'visibility');
//  
//      if (visibility === 'visible') {
//          map.setLayoutProperty(clickedLayer, 'visibility', 'none');
//          this.className = '';
//      } else {
//          this.className = 'active';
//          map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
//      }
//    }
//    
//};
//var layers = document.getElementById('menu');
//layers.appendChild(link);

//var toggleableLayerIds2011 = ['2013', '2013_state'];
//
//var link = document.createElement('a');
//link.href = '#';
//link.className = 'active';
//link.textContent = "2013";
//link.onclick = function (e) {
//    for(var index in toggleableLayerIds2013) {
//      var clickedLayer2013 = toggleableLayerIds2012[index];
//      e.preventDefault();
//      e.stopPropagation();
//  
//      var visibility2013 = map.getLayoutProperty(clickedLayer2013, 'visibility');
//  
//      if (visibility2013 === 'visible') {
//          map.setLayoutProperty(clickedLayer2013, 'visibility', 'none');
//          this.className = '';
//      } else {
//          this.className = 'active';
//          map.setLayoutProperty(clickedLayer2013, 'visibility', 'visible');
//      }
//    }
//    
//};
//var layers = document.getElementById('menu');
//layers.appendChild(link);
//
//
//var toggleableLayerIds = ['2014','2014_state'];
//
//var link = document.createElement('a');
//link.href = '#';
//link.className = 'active';
//link.textContent = "2014";
//link.onclick = function (e) {
//    for(var index in toggleableLayerIds) {
//      var clickedLayer = toggleableLayerIds[index];
//      e.preventDefault();
//      e.stopPropagation();
//  
//      var visibility = map.getLayoutProperty(clickedLayer, 'visibility');
//  
//      if (visibility === 'visible') {
//          map.setLayoutProperty(clickedLayer, 'visibility', 'none');
//          this.className = '';
//      } else {
//          this.className = 'active';
//          map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
//      }
//    }
//    
//};
//var layers = document.getElementById('menu');
//layers.appendChild(link);


var stateLegendEl = document.getElementById('state-legend');

stateLegendEl.style.display = 'block'



</script>

</body>
</html>